# --- Shared ---
export PATH="$PATH:$HOME/go/bin"

export EDITOR="nvim"
export VISUAL="nvim"

# Powerlevel10k instant prompt (keep near top)
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# --- OS-specific plugin locations ---
{{ if eq .chezmoi.os "darwin" }}
# macOS (Homebrew)
if command -v brew >/dev/null 2>&1; then
  HOMEBREW_PREFIX="$(brew --prefix)"

  for plugin_path in \
    "$HOMEBREW_PREFIX/share/zsh-autocomplete/zsh-autocomplete.plugin.zsh" \
    "$HOMEBREW_PREFIX/share/zsh-autosuggestions/zsh-autosuggestions.zsh"; do
    if [[ -r "$plugin_path" ]]; then
      source "$plugin_path"
      break
    fi
  done

  for theme_path in \
    "$HOMEBREW_PREFIX/share/powerlevel10k/powerlevel10k.zsh-theme" \
    "$HOMEBREW_PREFIX/opt/powerlevel10k/share/powerlevel10k/powerlevel10k.zsh-theme"; do
    if [[ -r "$theme_path" ]]; then
      source "$theme_path"
      break
    fi
  done
fi
{{ end }}

# Powerlevel10k (safe, cross-platform)
if [ -r "$HOME/.p10k.zsh" ]; then
  source "$HOME/.p10k.zsh"
fi
if [ -r "$HOME/.p10k.zshexport" ]; then
  source "$HOME/.p10k.zshexport"
fi
{{ if eq .chezmoi.os "darwin" }}
# macOS: If neither file exists, run: `p10k configure` to create ~/.p10k.zsh.
{{ else if eq .chezmoi.os "linux" }}
# Linux: If neither file exists, run: `p10k configure` to create ~/.p10k.zsh.
{{ else }}
# If neither file exists, run: `p10k configure` to create ~/.p10k.zsh.
{{ end }}
if [ ! -r "$HOME/.p10k.zsh" ] && [ ! -r "$HOME/.p10k.zshexport" ]; then
  source "$HOME/.p10k.fallback.zsh" 2>/dev/null || true
fi

{{- if eq .chezmoi.os "linux" -}}
export PATH="$HOME/.local/bin:$PATH"
setopt HIST_IGNORE_DUPS SHARE_HISTORY
autoload -Uz compinit && compinit -i

# fzf (guarded)
if [ -f /usr/share/fzf/shell/key-bindings.zsh ]; then source /usr/share/fzf/shell/key-bindings.zsh; fi

# zsh-autosuggestions (guarded)
if [ -f /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]; then source /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh; fi

# powerlevel10k (guarded)
if [ -f /usr/share/powerlevel10k/powerlevel10k.zsh-theme ]; then source /usr/share/powerlevel10k/powerlevel10k.zsh-theme; fi
{{- end -}}
