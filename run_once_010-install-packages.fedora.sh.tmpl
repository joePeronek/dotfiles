{{- if eq .chezmoi.os "linux" -}}
#!/usr/bin/env bash
set -euo pipefail

echo "[fedora-bootstrap] Checking platform..."
if [ ! -f /etc/os-release ]; then
  echo "[fedora-bootstrap] /etc/os-release not found; skipping."
  exit 0
fi
source /etc/os-release
[[ "${ID:-}" == "fedora" ]] || { echo "[fedora-bootstrap] Not a Fedora system; skipping."; exit 0; }

echo "[fedora-bootstrap] Installing base packages via dnf..."
sudo dnf -y install --skip-broken gcc gcc-c++ make curl git ripgrep fzf tmux neovim python3 python3-pip python3-virtualenv golang cmake meson autoconf automake libtool pkgconf-pkg-config wget unzip htop chezmoi zsh zsh-autosuggestions powerlevel10k jetbrains-mono-fonts || true

echo "[fedora-bootstrap] Verifying /usr/bin/zsh..."
if [ ! -x /usr/bin/zsh ]; then
  echo "[fedora-bootstrap] /usr/bin/zsh missing; leaving shell configuration unchanged."
  exit 0
fi

if ! grep -Fxq "/usr/bin/zsh" /etc/shells; then
  echo "[fedora-bootstrap] Adding /usr/bin/zsh to /etc/shells..."
  echo "/usr/bin/zsh" | sudo tee -a /etc/shells >/dev/null
else
  echo "[fedora-bootstrap] /usr/bin/zsh already listed in /etc/shells."
fi

if [ "${SHELL:-}" != "/usr/bin/zsh" ] && [ -t 1 ]; then
  echo "[fedora-bootstrap] Switching default shell to zsh for ${USER}..."
  chsh -s /usr/bin/zsh "$USER" || true
else
  echo "[fedora-bootstrap] Default shell already zsh or non-interactive session; no change."
fi

echo "[fedora-bootstrap] Fedora bootstrap complete."
{{- end -}}
